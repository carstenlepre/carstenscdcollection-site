<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Carsten's CD Collection Radio</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap');

  body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, rgb(73,105,114), #b07ea6);
    color: #eee;
    text-align: center;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 2rem;
    overflow: auto;
    position: relative;
  }

  body::before {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: linear-gradient(270deg,
      rgba(73,105,114,1) 0%,
      rgba(95,123,132,1) 15%,
      rgba(132,102,152,1) 40%,
      rgba(180,126,166,1) 60%,
      rgba(95,123,132,1) 85%,
      rgba(73,105,114,1) 100%);
    background-size: 1500% 1500%;
    animation: gradientShift 15s ease infinite;
    z-index: -2;
    filter: brightness(0.8);
  }

  @keyframes gradientShift {
    0% {background-position: 0% 50%;}
    50% {background-position: 100% 50%;}
    100% {background-position: 0% 50%;}
  }

  body::after {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    pointer-events: none;
    background: radial-gradient(circle at center, rgba(255,255,255,0.03) 1px, transparent 1px),
                radial-gradient(circle at center, rgba(0,0,0,0.03) 1px, transparent 1px);
    background-position: 0 0, 25px 25px;
    background-size: 50px 50px;
    z-index: -1;
  }

  #logo {
    max-width: 200px;
    margin: 0 auto 1rem auto;
    filter: drop-shadow(3px 3px 6px rgba(0,0,0,0.9));
  }

  h1 {
    font-size: 3.4rem;
    margin: 0.2em 0 0.5em 0;
    text-shadow: 3px 3px 5px rgba(0,0,0,0.7), 0 0 15px #4a6a72, 0 0 30px #6b8b93;
    letter-spacing: 1.2px;
    font-weight: 700;
    text-transform: uppercase;
    user-select: none;
  }

  #description {
    font-size: 1.3rem;
    margin-bottom: 2em;
    max-width: 420px;
    margin-left: auto;
    margin-right: auto;
    text-shadow: 1.5px 1.5px 5px rgba(0,0,0,0.5);
    font-style: italic;
    user-select: none;
  }

  audio {
    display: block;
    margin: 0 auto 2rem auto;
    width: 90%;
    max-width: 400px;
    border-radius: 14px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.7), inset 0 0 15px rgba(73,105,114,0.6);
    outline: none;
  }

  #waveform {
    width: 90%;
    max-width: 400px;
    height: 50px;
    margin: 0 auto 1.5em auto;
  }

  .bar {
    display: inline-block;
    width: 4px;
    margin: 0 2px;
    background: #4a6a72;
    animation: bounce 1.2s ease-in-out infinite;
    border-radius: 3px;
  }

  .bar:nth-child(n) {
    animation-delay: calc(0.15s * var(--n));
  }

  @keyframes bounce {
    0%, 100% { height: 10px; }
    50% { height: 40px; }
  }

  #now-playing {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: 1.9rem;
    margin-bottom: 1.2em;
    min-height: 5em;
    color: #e0f7fa;
    text-shadow: 2px 2px 8px #3a5a63, 0 0 10px #55a5b1;
    user-select: none;
    position: relative;
  }

  #now-playing img#cover-art {
    width: 120px;
    height: 120px;
    margin-bottom: 0.6em;
    border-radius: 12px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.85);
    transition: opacity 0.5s ease;
  }

  #recent-title {
    font-size: 1.4rem;
    margin-bottom: 0.5em;
    font-weight: 600;
    color: #d4e8eb;
    text-shadow: 1px 1px 4px #2b4147;
    user-select: none;
  }

  #recently-played {
    list-style: none;
    padding: 0;
    max-width: 420px;
    margin: 0 auto 2em auto;
    font-size: 1rem;
    background: rgba(0,0,0,0.12);
    border-radius: 8px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.6);
    user-select: none;
  }

  #recently-played li {
    padding: 0.5em 1em;
    border-bottom: 1px solid rgba(255,255,255,0.18);
  }

  #recently-played li:last-child {
    border-bottom: none;
  }

  #phone {
    font-size: 1.3rem;
    margin-top: auto;
    padding: 1em 0 0.3em 0;
    color: #cce7e9;
    text-shadow: 1.5px 1.5px 3px #204040, 0 0 15px #4a6a72;
    font-weight: 700;
    font-family: 'Poppins', sans-serif;
    user-select: none;
    cursor: pointer;
  }

  #phone:hover {
    animation: pulsePhone 1.5s infinite alternate ease-in-out;
  }

  @keyframes pulsePhone {
    0% { text-shadow: 1.5px 1.5px 3px #204040, 0 0 15px #4a6a72; }
    100% { text-shadow: 2.5px 2.5px 7px #204040, 0 0 30px #6b8b93; }
  }

  #social-prompt {
    font-size: 0.9rem;
    color: #b9d5d8;
    text-shadow: 1px 1px 2px #1a2e30;
    font-weight: 400;
    margin-top: 0.3em;
  }

  #social-prompt a {
    color: #cbeeff;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
  }

  #social-prompt a:hover {
    color: #ffffff;
    text-shadow: 0 0 8px #9feaff, 0 0 12px #4a6a72;
  }

  #about {
    max-width: 520px;
    margin: 0 auto 2em auto;
    font-size: 1rem;
    color: #ccc;
    text-shadow: 1px 1px 2px #111;
    padding: 1em 1.2em;
    overflow-wrap: break-word;
    word-break: break-word;
    line-height: 1.5;
  }
</style>
</head>
<body>

<img id="logo" src="https://i.imgur.com/VzBkTa5.png" alt="Carsten's CD Collection Logo" />

<h1>Carsten's CD Collection Radio</h1>
<div id="description">Streaming hand-picked tracks from a vast CD library â€“ live commentary included</div>

<audio controls autoplay>
  <source src="https://acidic-judicious-dill.glitch.me/proxy" type="audio/mpeg" />
  Your browser does not support the audio element.
</audio>

<div id="waveform" aria-hidden="true">
  <div class="bar" style="--n:1;"></div>
  <div class="bar" style="--n:2;"></div>
  <div class="bar" style="--n:3;"></div>
  <div class="bar" style="--n:4;"></div>
  <div class="bar" style="--n:5;"></div>
  <div class="bar" style="--n:6;"></div>
  <div class="bar" style="--n:7;"></div>
  <div class="bar" style="--n:8;"></div>
  <div class="bar" style="--n:9;"></div>
</div>

<div id="now-playing">Loading now playing...</div>

<div id="recent-title">Recently Played</div>
<ul id="recently-played"></ul>

<div id="phone">
  ðŸ“ž Want to request a song or just chat? Call or text: (908) 605-0391
  <div id="social-prompt">
    or DM me on Instagram at
    <a href="https://instagram.com/carstenscdradio" target="_blank">@carstenscdradio</a><br />
    (send in your own songs too!)
  </div>
</div>

<div id="about">
  My name is Carsten Lepre and I'm a 16 year old music lover and CD collector! Carsten's CD Collection brings you my absolute favorite cuts from my actual CD collection, from John Mayer to Coldplay, Beatles, Tame Impala, and more. Stick around for live commentary, album listen-throughs, and an all-around good time!
</div>

<script>
  const nowPlayingElem = document.getElementById('now-playing');
  const recentElem = document.getElementById('recently-played');
  let recentTracks = [];
  let lastTrack = '';

  function cleanTrackTitle(title) {
    return title.replace(/\s*\(.*?\)|\s*\[.*?\]/g, '').trim();
  }

  async function fetchCoverArt(track) {
    const cleanTitle = cleanTrackTitle(track);
    const url = `https://itunes.apple.com/search?term=${encodeURIComponent(cleanTitle)}&entity=song&limit=1`;
    try {
      const res = await fetch(url);
      const json = await res.json();
      if (json.resultCount > 0) {
        return json.results[0].artworkUrl100.replace('100x100bb.jpg', '300x300bb.jpg');
      }
      return null;
    } catch (e) {
      console.warn('Cover art fetch failed:', e);
      return null;
    }
  }

  async function fetchNowPlaying() {
    try {
      const res = await fetch('https://lime-abyssinian-responsibility.glitch.me/status-json');
      const data = await res.json();
      const title = data.icestats.source?.title || 'No track info available';
      if (title !== lastTrack && title !== 'No track info available') {
        lastTrack = title;
        nowPlayingElem.textContent = `Now Playing: ${title}`;
        const coverUrl = await fetchCoverArt(title);
        if (coverUrl) {
          let img = document.getElementById('cover-art');
          if (!img) {
            img = document.createElement('img');
            img.id = 'cover-art';
            nowPlayingElem.prepend(img);
          }
          img.src = coverUrl;
          img.style.opacity = '1';
        }
        if (!recentTracks.includes(title)) {
          recentTracks.unshift(title);
          if (recentTracks.length > 5) recentTracks.pop();
          renderRecent();
        }
      }
    } catch (e) {
      nowPlayingElem.textContent = 'Unable to load track info.';
    }
  }

  function renderRecent() {
    recentElem.innerHTML = '';
    recentTracks.forEach(track => {
      const li = document.createElement('li');
      li.textContent = track;
      recentElem.appendChild(li);
    });
  }

  fetchNowPlaying();
  setInterval(fetchNowPlaying, 15000);
</script>

</body>
</html>
